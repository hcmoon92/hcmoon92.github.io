<div id="strudel-container"></div>
<script type="module" src="https://cdn.jsdelivr.net/npm/@strudel/web@latest/dist/strudel.js"></script>
<script type="module">
  const layers = {};

  const patterns = [
    {name: "킥/스네어", pattern: "bd sd bd sd", bank: "RolandTR909"},
    {name: "하이햇", pattern: "hh*8", bank: "RolandTR909"},
    {name: "베이스", pattern: "c2 ~ c2 ~ e2 ~ g1 ~", sound: "sawtooth"}
  ];

  const container = document.getElementById("strudel-container");

  patterns.forEach((p, idx) => {
    const btn = document.createElement("button");
    btn.textContent = p.name;
    btn.style.margin = "5px";

    btn.addEventListener("click", () => {
      if (!layers[idx]) {
        let layer;
        if (p.pattern.match(/[a-g][0-9]/)) {
          layer = note(p.pattern).sound(p.sound || "sawtooth");
        } else {
          layer = s(p.pattern).bank(p.bank || "RolandTR909");
        }
        layers[idx] = layer;
      } else {
        delete layers[idx];
      }
      stack(...Object.values(layers));
    });

    container.appendChild(btn);
  });
</script>
